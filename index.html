<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Creator</title>
    <meta name="theme-color" content="#4285f4"/>
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="menu-toggle" id="menu-toggle"><span></span><span></span><span></span></div>
    <div class="overlay" id="overlay"></div>
    <nav class="nav-panel" id="nav-panel">
        <ul>
            <li><a href="./how-to.html">How to Create a File?</a></li>
            <li><a href="https://360pwatcher.github.io/Anilist/" target="_blank">Contact Us</a></li>
        </ul>
    </nav>
    
    <main>
        <div id="hero-section" class="hero-section">
             <h1 class="main-title">CREATE A QUIZ</h1>
             <p>Build your own interactive quizzes with ease.</p>
             <a href="#" id="show-creator-btn" class="button-style">Create Quiz</a>
             <img src="./hero-image.svg" alt="Quiz illustration" class="hero-image">
        </div>
        
        <div id="creator-section">
            <div class="container">
                <h1 class="main-title">Quiz Creator</h1>
                <p>Fill out the form below, or upload a formatted file.</p>
                <div class="creator-block">
                    <h3>Upload a Quiz File</h3>
                    <input type="file" id="quiz-file-input" accept=".txt,.csv">
                    <button id="create-from-file-btn">Create Link from File</button>
                </div>
                <div class="creator-block">
                    <h3>Or, Create Manually:</h3>
                    <div id="questions-container"></div>
                    <button id="add-question-btn">Add Another Question</button>
                    <button id="generate-manual-btn">Create Link from Form</button>
                </div>
                <div id="share-link-container">
                    <h3>Your quiz is ready!</h3>
                    <p>Copy the link to share, or start the quiz directly.</p>
                    <input type="text" id="share-link" readonly>
                    <button id="start-quiz-btn" class="button-style">Start Quiz Now</button>
                </div>
            </div>
        </div>

        <div id="quiz-view">
            <div class="container">
                <div id="quiz-header"><h2 id="question-counter"></h2><div id="timer">0s</div></div>
                <div class="question-block">
                    <div class="question" id="question-text"></div>
                    <div class="answers" id="answer-options"></div>
                </div>
                <div id="explanation-box" style="display: none;"><h3>Explanation</h3><p id="explanation-text"></p></div>
                <button id="submit-btn">Submit Answer</button>
                <button id="next-btn" style="display: none;">Next Question</button>
            </div>
        </div>

        <div id="results-view">
            <div class="container">
                <h1 class="main-title">Quiz Complete!</h1>
                <p id="final-score"></p><p id="total-time"></p>
                <h3>Performance Summary</h3>
                <div id="results-summary"></div>
                <button id="restart-creator-btn" class="button-style secondary-button">Create a New Quiz</button>
            </div>
        </div>
    </main>

    <script>
        const heroSection = document.getElementById('hero-section');
        const creatorSection = document.getElementById('creator-section');
        const quizView = document.getElementById('quiz-view');
        const resultsView = document.getElementById('results-view');
        const showCreatorBtn = document.getElementById('show-creator-btn');
        const questionsContainer = document.getElementById('questions-container');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const generateManualBtn = document.getElementById('generate-manual-btn');
        const fileInput = document.getElementById('quiz-file-input');
        const createFileBtn = document.getElementById('create-from-file-btn');
        const linkContainer = document.getElementById('share-link-container');
        const shareLinkInput = document.getElementById('share-link');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const qCounter = document.getElementById('question-counter');
        const timerDisplay = document.getElementById('timer');
        const qText = document.getElementById('question-text');
        const answerOpts = document.getElementById('answer-options');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartCreatorBtn = document.getElementById('restart-creator-btn');
        const menuToggle = document.getElementById('menu-toggle');
        const navPanel = document.getElementById('nav-panel');
        const overlay = document.getElementById('overlay');
        const body = document.body;

        let quizData = []; let currentQIndex = 0; let score = 0; let userAnswers = []; let timePerQuestion = []; let timerInterval; let questionStartTime; let questionCount = 0;
        
        function showView(viewToShow) { [heroSection, creatorSection, quizView, resultsView].forEach(view => view.style.display = 'none'); viewToShow.style.display = 'block'; if (viewToShow === heroSection) { viewToShow.style.display = 'flex'; } }
        function closeMenu() { navPanel.classList.remove('open'); overlay.classList.remove('open'); body.classList.remove('no-scroll'); menuToggle.classList.remove('is-active'); }
        menuToggle.addEventListener('click', () => { navPanel.classList.toggle('open'); overlay.classList.toggle('open'); body.classList.toggle('no-scroll'); menuToggle.classList.toggle('is-active'); });
        overlay.addEventListener('click', closeMenu);
        showCreatorBtn.addEventListener('click', (e) => { e.preventDefault(); showView(creatorSection); });
        restartCreatorBtn.addEventListener('click', () => showView(creatorSection));
        
        function addQuestion() { questionCount++; const block = document.createElement('div'); block.innerHTML = `<h4>Question ${questionCount}</h4><input type="text" placeholder="Enter your question" class="question-title"><input type="text" placeholder="Answer A" class="answer-a"><input type="text" placeholder="Answer B" class="answer-b"><input type="text" placeholder="Answer C" class="answer-c"><input type="text" placeholder="Answer D" class="answer-d"><input type="text" placeholder="Correct Answer Letter (a, b, c, or d)" class="correct-answer" maxlength="1"><textarea placeholder="Optional: Enter explanation here" class="explanation"></textarea>`; questionsContainer.appendChild(block); }
        function getQuizDataFromForm() { const data = []; document.querySelectorAll('#questions-container .creator-block').forEach(q => { const questionTitle = q.querySelector('.question-title').value; const answerA = q.querySelector('.answer-a').value; const answerB = q.querySelector('.answer-b').value; const answerC = q.querySelector('.answer-c').value; const answerD = q.querySelector('.answer-d').value; const correctAnswer = q.querySelector('.correct-answer').value.toLowerCase(); const explanation = q.querySelector('.explanation').value.trim(); if (questionTitle && answerA && answerB && answerC && answerD && correctAnswer) { data.push({ question: questionTitle, answers: { a: answerA, b: answerB, c: answerC, d: answerD }, correctAnswer: correctAnswer, explanation: explanation }); } }); return data; }
        createFileBtn.addEventListener('click', handleFileUpload);
        function handleFileUpload() { const file = fileInput.files[0]; if (!file) { alert('Please select a file.'); return; } const reader = new FileReader(); reader.onload = function(event) { const data = parseQuizText(event.target.result); if (data && data.length > 0) { generateShareLink(data); } else { alert('Could not parse the file. Please check the file format.'); } }; reader.readAsText(file); }
        function parseQuizText(text) { const data = []; const trimmedText = text.trim(); if (trimmedText.startsWith('"Question"')) { const lines = trimmedText.split('\n'); const csvRegex = /"([^"]*)"/g; for (let i = 1; i < lines.length; i++) { const fields = Array.from(lines[i].matchAll(csvRegex), m => m[1]); if (fields.length < 7) continue; data.push({ question: fields[0], answers: { a: fields[1], b: fields[2], c: fields[3], d: fields[4] }, correctAnswer: fields[5].trim().toLowerCase(), explanation: fields[6] }); } } else if (trimmedText.includes('\t')) { const lines = trimmedText.split('\n'); for (const line of lines) { if (line.startsWith('#') || !line.trim()) continue; const fields = line.split('\t'); if (fields.length < 7) continue; data.push({ question: fields[0], answers: { a: fields[1], b: fields[2], c: fields[3], d: fields[4] }, correctAnswer: fields[5].trim().toLowerCase(), explanation: fields[6] }); } } else { const questionBlocks = trimmedText.split(/\n\s*\n/); for (const block of questionBlocks) { const lines = block.split('\n'); if (lines.length < 6) continue; const explanationLine = lines[6] || 'EXPLANATION:'; const explanation = explanationLine.startsWith('EXPLANATION:') ? explanationLine.substring(12).trim() : ''; data.push({ question: lines[0].trim(), answers: { a: lines[1].trim(), b: lines[2].trim(), c: lines[3].trim(), d: lines[4].trim() }, correctAnswer: lines[5].substring(8).trim().toLowerCase(), explanation: explanation }); } } return data; }
        function generateShareLink(data) { quizData = data; if (!quizData || quizData.length === 0) { alert("No valid questions found."); return; } try { const quizKey = `quiz_${Date.now()}`; const jsonString = JSON.stringify(quizData); localStorage.setItem(quizKey, jsonString); const baseUrl = window.location.href.replace('index.html', '').replace(/\/$/, ''); const quizUrl = `${baseUrl}/quiz.html?key=${quizKey}`; shareLinkInput.value = quizUrl; linkContainer.style.display = 'block'; } catch (error) { alert("An error occurred. Your browser may be in private mode or storage might be full."); console.error("Link generation failed:", error); } }
        addQuestionBtn.addEventListener('click', addQuestion); generateManualBtn.addEventListener('click', () => { generateShareLink(getQuizDataFromForm()); }); addQuestion();
        startQuizBtn.addEventListener('click', (e) => { e.preventDefault(); startQuiz(quizData); });

        function startQuiz(data) { quizData = data; currentQIndex = 0; score = 0; userAnswers = []; timePerQuestion = []; showView(quizView); displayQuestion(); }
        function startTimer() { questionStartTime = Date.now(); timerInterval = setInterval(() => { timerDisplay.textContent = `${Math.floor((Date.now() - questionStartTime) / 1000)}s`; }, 1000); }
        function stopTimer() { clearInterval(timerInterval); timePerQuestion.push(Math.round((Date.now() - questionStartTime) / 1000)); }
        function displayQuestion() { explanationBox.style.display = 'none'; submitBtn.style.display = 'inline-block'; nextBtn.style.display = 'none'; answerOpts.innerHTML = ''; const currentQ = quizData[currentQIndex]; qCounter.textContent = `Question ${currentQIndex + 1} of ${quizData.length}`; qText.textContent = currentQ.question; for (const letter in currentQ.answers) { const label = document.createElement('label'); const answerText = currentQ.answers[letter]; label.innerHTML = `<input type="radio" name="answer" value="${letter}">`; label.appendChild(document.createTextNode(` ${letter.toUpperCase()}: ${answerText}`)); answerOpts.appendChild(label); } if (window.MathJax) { MathJax.typeset(); } startTimer(); }
        submitBtn.addEventListener('click', function() { const selectedRadio = answerOpts.querySelector('input[name="answer"]:checked'); if (!selectedRadio) { alert('Please select an answer!'); return; } stopTimer(); const userAnswer = selectedRadio.value; const currentQ = quizData[currentQIndex]; userAnswers.push(userAnswer); answerOpts.querySelectorAll('input').forEach(input => input.disabled = true); const correctLabel = answerOpts.querySelector(`input[value="${currentQ.correctAnswer}"]`).parentElement; correctLabel.classList.add('correct'); if (userAnswer === currentQ.correctAnswer) { score++; } else { selectedRadio.parentElement.classList.add('incorrect'); } if (currentQ.explanation) { explanationText.textContent = currentQ.explanation; explanationBox.style.display = 'block'; if (window.MathJax) { MathJax.typesetPromise([explanationBox]).catch((err) => console.log(err.message)); } } submitBtn.style.display = 'none'; nextBtn.style.display = 'inline-block'; if (currentQIndex === quizData.length - 1) { nextBtn.textContent = 'Show Results'; } });
        nextBtn.addEventListener('click', function() { currentQIndex++; if (currentQIndex < quizData.length) { displayQuestion(); } else { displayResults(); } });
        function displayResults() { showView(resultsView); document.getElementById('final-score').textContent = `Final Score: ${score} out of ${quizData.length}`; const totalTime = timePerQuestion.reduce((a, b) => a + b, 0); document.getElementById('total-time').textContent = `Total Time: ${totalTime} seconds`; let summaryHtml = '<table><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Time</th></tr>'; quizData.forEach((q, i) => { const isCorrect = userAnswers[i] === q.correctAnswer; const statusClass = isCorrect ? 'result-correct' : 'result-incorrect'; const statusSymbol = isCorrect ? '✔' : '✖'; const userAnswerText = `${userAnswers[i].toUpperCase()}: ${q.answers[userAnswers[i]]}`; const correctAnswerText = `Correct: ${q.correctAnswer.toUpperCase()}: ${q.answers[q.correctAnswer]}`; summaryHtml += `<tr><td class="${statusClass}">${statusSymbol}</td><td>${q.question}</td><td>${userAnswerText} <br><small class="${statusClass}">${isCorrect ? '' : correctAnswerText}</small></td><td>${timePerQuestion[i]}s</td></tr>`; }); summaryHtml += '</table>'; document.getElementById('results-summary').innerHTML = summaryHtml; if (window.MathJax) { MathJax.typesetPromise([resultsView]).catch((err) => console.log(err.message)); } }
        
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./service-worker.js'); }); }
    </script>
</body>
</html>
