<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Creator</title>
    <link rel="stylesheet" href="style.css">
    <style>
        input[type=text], textarea { width: 95%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        textarea { height: 60px; }
        .creator-block { border: 2px dashed #ccc; padding: 15px; margin-bottom: 15px; }
        #share-link-container { margin-top: 20px; background-color: #e9f5ff; padding: 10px; border-radius: 5px; display: none; }
        #share-link { width: 100%; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>
    <h1>Create Your Own Quiz</h1>
    <p>Fill out the form below, or upload a formatted .txt file (with optional explanations).</p>

    <div class="creator-block">
        <h3>Upload a Quiz File</h3>
        <p>Use the 7-line format per question (.txt file).</p>
        <input type="file" id="quiz-file-input" accept=".txt">
        <button id="create-from-file-btn">Create Link from File</button>
    </div>
    <hr>
    
    <h3>Or, Create Manually:</h3>
    <div id="questions-container"></div>
    <button id="add-question-btn">Add Another Question</button>
    <button id="generate-manual-btn">Create Link from Form</button>
    
    <div id="share-link-container">
        <strong>Your quiz is ready! Copy and share this link:</strong>
        <input type="text" id="share-link" readonly>
    </div>

    <script>
        const questionsContainer = document.getElementById('questions-container');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const generateManualBtn = document.getElementById('generate-manual-btn');
        const fileInput = document.getElementById('quiz-file-input');
        const createFileBtn = document.getElementById('create-from-file-btn');
        const linkContainer = document.getElementById('share-link-container');
        const shareLinkInput = document.getElementById('share-link');
        let questionCount = 0;

        function addQuestion() {
            questionCount++;
            const block = document.createElement('div');
            block.className = 'creator-block';
            block.innerHTML = `<h4>Question ${questionCount}</h4><input type="text" placeholder="Enter your question" class="question-title"><input type="text" placeholder="Answer A" class="answer-a"><input type="text" placeholder="Answer B" class="answer-b"><input type="text" placeholder="Answer C" class="answer-c"><input type="text" placeholder="Answer D" class="answer-d"><input type="text" placeholder="Correct Answer Letter (a, b, c, or d)" class="correct-answer" maxlength="1"><textarea placeholder="Optional: Enter explanation here" class="explanation"></textarea>`;
            questionsContainer.appendChild(block);
        }

        function getQuizDataFromForm() {
            const quizData = [];
            document.querySelectorAll('#questions-container .creator-block').forEach(q => {
                const questionTitle = q.querySelector('.question-title').value; const answerA = q.querySelector('.answer-a').value; const answerB = q.querySelector('.answer-b').value; const answerC = q.querySelector('.answer-c').value; const answerD = q.querySelector('.answer-d').value; const correctAnswer = q.querySelector('.correct-answer').value.toLowerCase(); const explanation = q.querySelector('.explanation').value.trim();
                if (questionTitle && answerA && answerB && answerC && answerD && correctAnswer) { quizData.push({ question: questionTitle, answers: { a: answerA, b: answerB, c: answerC, d: answerD }, correctAnswer: correctAnswer, explanation: explanation }); }
            });
            return quizData;
        }

        function handleFileUpload() {
            const file = fileInput.files[0]; if (!file) return alert('Please select a file.'); const reader = new FileReader();
            reader.onload = function(event) {
                const quizData = parseQuizText(event.target.result);
                if (quizData && quizData.length > 0) generateShareLink(quizData); else alert('Could not parse the file. Check the 7-line format.');
            };
            reader.readAsText(file);
        }

        function parseQuizText(text) {
            const quizData = []; const questionBlocks = text.trim().split(/\n\s*\n/);
            for (const block of questionBlocks) {
                const lines = block.split('\n'); if (lines.length < 6) continue; const explanationLine = lines[6] || 'EXPLANATION:'; const explanation = explanationLine.startsWith('EXPLANATION:') ? explanationLine.substring(12).trim() : '';
                quizData.push({ question: lines[0].trim(), answers: { a: lines[1].trim(), b: lines[2].trim(), c: lines[3].trim(), d: lines[4].trim() }, correctAnswer: lines[5].substring(8).trim().toLowerCase(), explanation: explanation });
            }
            return quizData;
        }
        
        function generateShareLink(quizData) {
            if (!quizData || quizData.length === 0) return alert("No valid questions found.");
            const jsonString = JSON.stringify(quizData);
            // --- THE NEW, SIMPLER ENCODING LINE ---
            const encodedData = encodeURIComponent(jsonString);
            const quizUrl = `${window.location.href.replace('index.html', '').replace(/\/$/, '')}/quiz.html?data=${encodedData}`;
            shareLinkInput.value = quizUrl;
            linkContainer.style.display = 'block';
            shareLinkInput.select();
        }

        addQuestionBtn.addEventListener('click', addQuestion);
        generateManualBtn.addEventListener('click', () => generateShareLink(getQuizDataFromForm()));
        createFileBtn.addEventListener('click', handleFileUpload);
        addQuestion();
    </script>
</body>
</html>
