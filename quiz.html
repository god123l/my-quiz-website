<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Awesome Quiz</title>
    <link rel="stylesheet" href="style.css">
    <style> /* Adding debug style here */
        #debug-panel { display: none; margin-top: 20px; padding: 15px; background-color: #fff0f0; border: 2px solid red; border-radius: 5px; }
        #debug-panel h3 { margin-top: 0; color: red; }
        #debug-panel pre { white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; padding: 10px; }
    </style>
</head>
<body>
    <div id="quiz-view">
        <div id="quiz-header"><h2 id="question-counter"></h2><div id="timer">0s</div></div>
        <div class="question-block"><div class="question" id="question-text"></div><div class="answers" id="answer-options"></div></div>
        <div id="explanation-box" style="display: none;"><h3>Explanation</h3><p id="explanation-text"></p></div>
        <button id="submit-btn">Submit Answer</button><button id="next-btn" style="display: none;">Next Question</button>
    </div>
    <div id="results-view" style="display: none;">
        <h2>Quiz Complete!</h2><p id="final-score"></p><p id="total-time"></p><h3>Performance Summary</h3>
        <div id="results-summary"></div><a href="index.html" class="button-style">Create a New Quiz</a>
    </div>
    <div id="error-container" style="display: none;">
        <h1>Oops!</h1><p>Could not load the quiz from the link.</p>
    </div>
    <!-- NEW: The Debugging Panel -->
    <div id="debug-panel">
        <h3>Debugging Information</h3>
        <p>Please copy all the text in the boxes below and send it to get help.</p>
        <strong>Error Message:</strong>
        <pre id="debug-error"></pre>
        <strong>Raw Data from URL:</strong>
        <pre id="debug-raw-data"></pre>
        <strong>Decoded Text (before parsing):</strong>
        <pre id="debug-decoded-text"></pre>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const quizView = document.getElementById('quiz-view');
        const resultsView = document.getElementById('results-view');
        const errorContainer = document.getElementById('error-container');
        const debugPanel = document.getElementById('debug-panel');
        // All other DOM elements... (condensed for brevity)
        const qCounter = document.getElementById('question-counter'); const timerDisplay = document.getElementById('timer'); const qText = document.getElementById('question-text'); const answerOpts = document.getElementById('answer-options'); const explanationBox = document.getElementById('explanation-box'); const explanationText = document.getElementById('explanation-text'); const submitBtn = document.getElementById('submit-btn'); const nextBtn = document.getElementById('next-btn');
        let quizData = [], currentQIndex = 0, score = 0, userAnswers = [], timePerQuestion = [], timerInterval, questionStartTime;

        function startTimer() { questionStartTime = Date.now(); timerInterval = setInterval(() => { timerDisplay.textContent = `${Math.floor((Date.now() - questionStartTime) / 1000)}s`; }, 1000); }
        function stopTimer() { clearInterval(timerInterval); timePerQuestion.push(Math.round((Date.now() - questionStartTime) / 1000)); }
        function displayQuestion() { explanationBox.style.display = 'none'; submitBtn.style.display = 'inline-block'; nextBtn.style.display = 'none'; answerOpts.innerHTML = ''; const currentQ = quizData[currentQIndex]; qCounter.textContent = `Question ${currentQIndex + 1} of ${quizData.length}`; qText.textContent = currentQ.question; for (const letter in currentQ.answers) { const label = document.createElement('label'); label.innerHTML = `<input type="radio" name="answer" value="${letter}"> ${letter.toUpperCase()}: ${currentQ.answers[letter]}`; answerOpts.appendChild(label); } startTimer(); }
        submitBtn.addEventListener('click', function() { const selectedRadio = answerOpts.querySelector('input[name="answer"]:checked'); if (!selectedRadio) { alert('Please select an answer!'); return; } stopTimer(); const userAnswer = selectedRadio.value; const currentQ = quizData[currentQIndex]; userAnswers.push(userAnswer); answerOpts.querySelectorAll('input').forEach(input => input.disabled = true); const correctLabel = answerOpts.querySelector(`input[value="${currentQ.correctAnswer}"]`).parentElement; correctLabel.classList.add('correct'); if (userAnswer === currentQ.correctAnswer) { score++; } else { selectedRadio.parentElement.classList.add('incorrect'); } if (currentQ.explanation) { explanationText.textContent = currentQ.explanation; explanationBox.style.display = 'block'; } submitBtn.style.display = 'none'; nextBtn.style.display = 'inline-block'; if (currentQIndex === quizData.length - 1) { nextBtn.textContent = 'Show Results'; } });
        nextBtn.addEventListener('click', function() { currentQIndex++; if (currentQIndex < quizData.length) { displayQuestion(); } else { displayResults(); } });
        function displayResults() { quizView.style.display = 'none'; resultsView.style.display = 'block'; document.getElementById('final-score').textContent = `Final Score: ${score} out of ${quizData.length}`; const totalTime = timePerQuestion.reduce((a, b) => a + b, 0); document.getElementById('total-time').textContent = `Total Time: ${totalTime} seconds`; let summaryHtml = '<table><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Time</th></tr>'; quizData.forEach((q, i) => { const isCorrect = userAnswers[i] === q.correctAnswer; const statusClass = isCorrect ? 'result-correct' : 'result-incorrect'; const statusSymbol = isCorrect ? '✔' : '✖'; const userAnswerText = `${userAnswers[i].toUpperCase()}: ${q.answers[userAnswers[i]]}`; const correctAnswerText = `Correct: ${q.correctAnswer.toUpperCase()}: ${q.answers[q.correctAnswer]}`; summaryHtml += `<tr><td class="${statusClass}">${statusSymbol}</td><td>${q.question}</td><td>${userAnswerText} <br><small class="${statusClass}">${isCorrect ? '' : correctAnswerText}</small></td><td>${timePerQuestion[i]}s</td></tr>`; }); summaryHtml += '</table>'; document.getElementById('results-summary').innerHTML = summaryHtml; }

        // --- THE UPDATED INITIALIZATION AND DEBUGGING BLOCK ---
        const urlParams = new URLSearchParams(window.location.search);
        const encodedData = urlParams.get('data');
        try {
            if (!encodedData) throw new Error("No 'data' parameter was found in the URL.");

            // Decode the data robustly
            const jsonString = decodeURIComponent(encodedData);
            quizData = JSON.parse(jsonString);
            
            if (!Array.isArray(quizData) || quizData.length === 0) throw new Error("Parsed data is not a valid, non-empty quiz array.");
            
            displayQuestion();

        } catch (e) {
            // If anything fails, show the error container AND the debug panel
            quizView.style.display = 'none';
            resultsView.style.display = 'none';
            errorContainer.style.display = 'block';
            debugPanel.style.display = 'block';
            
            // Populate the debug panel with useful info
            document.getElementById('debug-error').textContent = e.message;
            document.getElementById('debug-raw-data').textContent = encodedData || "Not found";
            try {
                // Try to decode even if parsing fails, to see what the text looks like
                document.getElementById('debug-decoded-text').textContent = decodeURIComponent(encodedData);
            } catch (decodeError) {
                document.getElementById('debug-decoded-text').textContent = "Could not even decode the text. It may be corrupted.";
            }
        }
    });
    </script>
</body>
</html>
